# three-ds-server

## проблемы

1 ) на проде серверу нужно хранить состояние (имплементация cacheService) + многонодность

2 ) на проде надо выпилить текущий xULTestCaseRunId, serialNum и cardRanges един для всего сервера

(пояснение)
в тестовом окружении, чтобы получить serialNum к серверу приходит внешний запрос PPrq , который инициирует получение serialNum для 
каждого нового authentication message flow *заново*! при получении любого следующего PPrq (кроме первого) используется   
serialNum из кеша. при этом в качестве уникального ключа используется xULTestCaseRunId из хедера http запроса, который 
отправляет тестовая лаборатория. лаба умеет идентифицировать каждый тест отдельно и добавлять к отдельным http запросам 
в рамках одного теста параметр xULTestCaseRunId, на проде это не нужно

3) нужен шедулятор, который будет самостоятельно дергать DS сообщениями PReq и сохранять cardRanges

(пояснение)
preq не является частью authentication message flow
согласно пункту 5.6  доки v2.2.0 3дс сервер отправляет в дс запрос в первый раз без serialNum и получает полный cardRanges.
в дальнейшем в запросе добавляется serialNum , дс будет возвращать частичные изменения. 

4 ) асинхронный 3ds-сервер 

5 ) совмещение тестового окржения и прода (интерфейсы, абстракции, @ConditionalOnProperty("test-env"))
